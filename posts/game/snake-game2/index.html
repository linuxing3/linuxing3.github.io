<!doctype html><html lang=en><head><title>snake-game2.md :: Vim Emacser Personal Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="从零开始设计一个类贪吃蛇的框架（二） 从零开始设计一个类贪吃蛇的框架（一）
从零开始设计一个类贪吃蛇的框架（三）
画蛇身 画出蛇身也很简单，可以把蛇想象成很多节，每节就是一个方框
画蛇全身就是把多个方框连接起来
首先我们定义蛇的一些基本属性 snake ={ x={}, y={}, nodes=5, nodeArray={}, direction=1, life=1, sprite=nil, brain=nil } 其中x和y是我们用来存放每节蛇身坐标的数组
我们的node是蛇身节的数量
首先画蛇身的函数添加到Play中 function SnakeGameController:Play() self:drawSnakeNode(RED) end 接下来就是画蛇身的函数 在ctor函数中增加以下代码来初始化蛇的属性
for i=1,snake[&amp;#34;nodes&amp;#34;] do snake[&amp;#34;x&amp;#34;][i] = display.cx - (COLUMN-i) *45 snake[&amp;#34;y&amp;#34;][i] = display.cy - (ROW-1) *45 print(snake[&amp;#34;x&amp;#34;][i]..snake[&amp;#34;y&amp;#34;][i]) end 在文件中增加以下函数
function SnakeGameController:drawSnakeNode(color) for i=1,snake[&amp;#34;nodes&amp;#34;] do local node = self:drawGridNode(snake[&amp;#34;x&amp;#34;][i],snake[&amp;#34;y&amp;#34;][i],color) end end 这样我们的蛇就画出来了！
让蛇动起来 激动人心的时候到了，让蛇动起来。
动画离不开帧的概念，我们的思路就是，每一帧把蛇身末尾的一节去除，在头部增加一节，这样蛇身就产生了移动效果了
先增加一个函数SnakeGameController:moveSnake function SnakeGameController:moveSnake() print(&amp;#34;original coordinates&amp;#34;) local lenght = snake[&amp;#34;nodes&amp;#34;] for i=1,snake[&amp;#34;nodes&amp;#34;] do--/*蛇每环节往前移动,也贪吃蛇关键算法*/ print(snake[&amp;#34;x&amp;#34;][i]."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/posts/game/snake-game2/><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/assets/green.css><link rel=apple-touch-icon href=/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=/img/favicon/green.png><meta name=twitter:card content="summary"><meta name=twitter:site content="https://twitter.com/linuxing3"><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="snake-game2.md"><meta property="og:description" content="从零开始设计一个类贪吃蛇的框架（二） 从零开始设计一个类贪吃蛇的框架（一）
从零开始设计一个类贪吃蛇的框架（三）
画蛇身 画出蛇身也很简单，可以把蛇想象成很多节，每节就是一个方框
画蛇全身就是把多个方框连接起来
首先我们定义蛇的一些基本属性 snake ={ x={}, y={}, nodes=5, nodeArray={}, direction=1, life=1, sprite=nil, brain=nil } 其中x和y是我们用来存放每节蛇身坐标的数组
我们的node是蛇身节的数量
首先画蛇身的函数添加到Play中 function SnakeGameController:Play() self:drawSnakeNode(RED) end 接下来就是画蛇身的函数 在ctor函数中增加以下代码来初始化蛇的属性
for i=1,snake[&amp;#34;nodes&amp;#34;] do snake[&amp;#34;x&amp;#34;][i] = display.cx - (COLUMN-i) *45 snake[&amp;#34;y&amp;#34;][i] = display.cy - (ROW-1) *45 print(snake[&amp;#34;x&amp;#34;][i]..snake[&amp;#34;y&amp;#34;][i]) end 在文件中增加以下函数
function SnakeGameController:drawSnakeNode(color) for i=1,snake[&amp;#34;nodes&amp;#34;] do local node = self:drawGridNode(snake[&amp;#34;x&amp;#34;][i],snake[&amp;#34;y&amp;#34;][i],color) end end 这样我们的蛇就画出来了！
让蛇动起来 激动人心的时候到了，让蛇动起来。
动画离不开帧的概念，我们的思路就是，每一帧把蛇身末尾的一节去除，在头部增加一节，这样蛇身就产生了移动效果了
先增加一个函数SnakeGameController:moveSnake function SnakeGameController:moveSnake() print(&amp;#34;original coordinates&amp;#34;) local lenght = snake[&amp;#34;nodes&amp;#34;] for i=1,snake[&amp;#34;nodes&amp;#34;] do--/*蛇每环节往前移动,也贪吃蛇关键算法*/ print(snake[&amp;#34;x&amp;#34;][i]."><meta property="og:url" content="/posts/game/snake-game2/"><meta property="og:site_name" content="Vim Emacser Personal Blog"><meta property="og:image" content="/img/favicon/green.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2018-02-16 14:05:34 -0400 -0400"></head><body class=green><div class="container full"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>Terminal</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/journal>Journal</a></li><li><a href=/showcase>Showcase</a></li><div class=spacer></div><ul class=language-selector><ul class=language-selector-current><li>English ▾</li></ul><ul class="language-selector__more hidden"><li><a href=/>English</a></li><li><a href=/zh/>中文</a></li></ul></ul></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/journal>Journal</a></li><li><a href=/showcase>Showcase</a></li><hr><li><a href=/>English</a></li><li><a href=/zh/>中文</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=/posts/game/snake-game2/>snake-game2.md</a></h1><div class=post-meta><span class=post-date>2018-02-16</span></div><div class=post-content><div><h1 id=从零开始设计一个类贪吃蛇的框架二>从零开始设计一个类贪吃蛇的框架（二）<a href=#从零开始设计一个类贪吃蛇的框架二 class=hanchor arialabel=Anchor>&#8983;</a></h1><p><a href=snake-game1>从零开始设计一个类贪吃蛇的框架（一）</a></p><p><a href=snake-game3>从零开始设计一个类贪吃蛇的框架（三）</a></p><h2 id=画蛇身>画蛇身<a href=#画蛇身 class=hanchor arialabel=Anchor>&#8983;</a></h2><p>画出蛇身也很简单，可以把蛇想象成很多节，每节就是一个方框</p><p>画蛇全身就是把多个方框连接起来</p><h3 id=首先我们定义蛇的一些基本属性>首先我们定义蛇的一些基本属性<a href=#首先我们定义蛇的一些基本属性 class=hanchor arialabel=Anchor>&#8983;</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span>    snake <span style=color:#f92672>=</span>{
</span></span><span style=display:flex><span>        x<span style=color:#f92672>=</span>{},
</span></span><span style=display:flex><span>        y<span style=color:#f92672>=</span>{},
</span></span><span style=display:flex><span>        nodes<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>,
</span></span><span style=display:flex><span>        nodeArray<span style=color:#f92672>=</span>{},
</span></span><span style=display:flex><span>        direction<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>        life<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>        sprite<span style=color:#f92672>=</span><span style=color:#66d9ef>nil</span>,
</span></span><span style=display:flex><span>        brain<span style=color:#f92672>=</span><span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>其中<code>x</code>和<code>y</code>是我们用来存放每节蛇身坐标的数组</p><p>我们的<code>node</code>是蛇身节的数量</p><h3 id=首先画蛇身的函数添加到play中>首先画蛇身的函数添加到<code>Play</code>中<a href=#首先画蛇身的函数添加到play中 class=hanchor arialabel=Anchor>&#8983;</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span>      <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>SnakeGameController</span>:<span style=color:#a6e22e>Play</span>()
</span></span><span style=display:flex><span>          self:drawSnakeNode(RED)
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>end</span>
</span></span></code></pre></div><h3 id=接下来就是画蛇身的函数>接下来就是画蛇身的函数<a href=#接下来就是画蛇身的函数 class=hanchor arialabel=Anchor>&#8983;</a></h3><p>在<code>ctor</code>函数中增加以下代码来初始化蛇的属性</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span>      <span style=color:#66d9ef>for</span> i<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>,snake[<span style=color:#e6db74>&#34;nodes&#34;</span>] <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>          snake[<span style=color:#e6db74>&#34;x&#34;</span>][i] <span style=color:#f92672>=</span> display.cx <span style=color:#f92672>-</span> (COLUMN<span style=color:#f92672>-</span>i) <span style=color:#f92672>*</span><span style=color:#ae81ff>45</span>
</span></span><span style=display:flex><span>          snake[<span style=color:#e6db74>&#34;y&#34;</span>][i] <span style=color:#f92672>=</span> display.cy <span style=color:#f92672>-</span> (ROW<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span><span style=color:#ae81ff>45</span>
</span></span><span style=display:flex><span>          print(snake[<span style=color:#e6db74>&#34;x&#34;</span>][i]<span style=color:#f92672>..</span>snake[<span style=color:#e6db74>&#34;y&#34;</span>][i])
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>end</span>
</span></span></code></pre></div><p>在文件中增加以下函数</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span>      <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>SnakeGameController</span>:<span style=color:#a6e22e>drawSnakeNode</span>(color)
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>for</span> i<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>,snake[<span style=color:#e6db74>&#34;nodes&#34;</span>] <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>              <span style=color:#66d9ef>local</span> node <span style=color:#f92672>=</span> self:drawGridNode(snake[<span style=color:#e6db74>&#34;x&#34;</span>][i],snake[<span style=color:#e6db74>&#34;y&#34;</span>][i],color)
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>end</span>
</span></span></code></pre></div><p>这样我们的蛇就画出来了！</p><h4 id=让蛇动起来>让蛇动起来<a href=#让蛇动起来 class=hanchor arialabel=Anchor>&#8983;</a></h4><p>激动人心的时候到了，让蛇动起来。</p><p>动画离不开帧的概念，我们的思路就是，每一帧把蛇身末尾的一节去除，在头部增加一节，这样蛇身就产生了移动效果了</p><h5 id=先增加一个函数snakegamecontrollermovesnake>先增加一个函数<code>SnakeGameController:moveSnake</code><a href=#先增加一个函数snakegamecontrollermovesnake class=hanchor arialabel=Anchor>&#8983;</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span>    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>SnakeGameController</span>:<span style=color:#a6e22e>moveSnake</span>()
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;original coordinates&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>local</span> lenght <span style=color:#f92672>=</span> snake[<span style=color:#e6db74>&#34;nodes&#34;</span>]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>,snake[<span style=color:#e6db74>&#34;nodes&#34;</span>] <span style=color:#66d9ef>do</span><span style=color:#75715e>--/*蛇每环节往前移动,也贪吃蛇关键算法*/</span>
</span></span><span style=display:flex><span>               print(snake[<span style=color:#e6db74>&#34;x&#34;</span>][i]<span style=color:#f92672>..</span>snake[<span style=color:#e6db74>&#34;y&#34;</span>][i])
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>-- remove last node</span>
</span></span><span style=display:flex><span>        self:drawGridNode(snake[<span style=color:#e6db74>&#34;x&#34;</span>][<span style=color:#ae81ff>1</span>], snake[<span style=color:#e6db74>&#34;y&#34;</span>][<span style=color:#ae81ff>1</span>],BLACK)
</span></span><span style=display:flex><span>        table.remove(snake[<span style=color:#e6db74>&#34;x&#34;</span>],<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        table.remove(snake[<span style=color:#e6db74>&#34;y&#34;</span>],<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        <span style=color:#75715e>-- 查看方向</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>local</span> switch <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>            [<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>()
</span></span><span style=display:flex><span>                table.insert(snake[<span style=color:#e6db74>&#34;x&#34;</span>],lenght,snake[<span style=color:#e6db74>&#34;x&#34;</span>][lenght<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>+</span> <span style=color:#ae81ff>45</span>)
</span></span><span style=display:flex><span>                table.insert(snake[<span style=color:#e6db74>&#34;y&#34;</span>],lenght,snake[<span style=color:#e6db74>&#34;y&#34;</span>][lenght<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>])
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>end</span>,
</span></span><span style=display:flex><span>            [<span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>()
</span></span><span style=display:flex><span>                table.insert(snake[<span style=color:#e6db74>&#34;x&#34;</span>],lenght,snake[<span style=color:#e6db74>&#34;x&#34;</span>][lenght<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>-</span> <span style=color:#ae81ff>45</span>)
</span></span><span style=display:flex><span>                table.insert(snake[<span style=color:#e6db74>&#34;y&#34;</span>],lenght,snake[<span style=color:#e6db74>&#34;y&#34;</span>][lenght<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>])
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>end</span>,
</span></span><span style=display:flex><span>            [<span style=color:#ae81ff>3</span>] <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>()
</span></span><span style=display:flex><span>                table.insert(snake[<span style=color:#e6db74>&#34;y&#34;</span>],lenght,snake[<span style=color:#e6db74>&#34;y&#34;</span>][lenght<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>+</span> <span style=color:#ae81ff>45</span>)
</span></span><span style=display:flex><span>                table.insert(snake[<span style=color:#e6db74>&#34;x&#34;</span>],lenght,snake[<span style=color:#e6db74>&#34;x&#34;</span>][lenght<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>])
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>end</span>,
</span></span><span style=display:flex><span>            [<span style=color:#ae81ff>4</span>] <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>()
</span></span><span style=display:flex><span>                table.insert(snake[<span style=color:#e6db74>&#34;y&#34;</span>],lenght,snake[<span style=color:#e6db74>&#34;y&#34;</span>][lenght<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>-</span> <span style=color:#ae81ff>45</span>)
</span></span><span style=display:flex><span>                table.insert(snake[<span style=color:#e6db74>&#34;x&#34;</span>],lenght,snake[<span style=color:#e6db74>&#34;x&#34;</span>][lenght<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>])
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>end</span>,
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#75715e>--按方向更新蛇每节坐标数组</span>
</span></span><span style=display:flex><span>        switch[snake[<span style=color:#e6db74>&#34;direction&#34;</span>]]()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;updating coordinates&#34;</span>)
</span></span><span style=display:flex><span>        self:drawSnakeNode(RED)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span></code></pre></div><p><code>lua</code>语言中没有<code>switch</code>的关键字，但是通过表和闭包的方式，我们很容易可以模拟出<code>switch</code>的效果</p><p>上面函数中<code>switch</code>的主要目的是判断蛇的方向</p><h5 id=然后要在帧动画中注册这个方法>然后要在帧动画中注册这个方法<a href=#然后要在帧动画中注册这个方法 class=hanchor arialabel=Anchor>&#8983;</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span>    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>SnakeGameController</span>:<span style=color:#a6e22e>onEnterFrame</span>(dt)
</span></span><span style=display:flex><span>            self:moveSnake()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span></code></pre></div><h5 id=并将帧动画实现函数注册到onenter函数中>并将帧动画实现函数，注册到<code>onEnter</code>函数中<a href=#并将帧动画实现函数注册到onenter函数中 class=hanchor arialabel=Anchor>&#8983;</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span>     self:schedule((<span style=color:#66d9ef>function</span>(dt) self:onEnterFrame(dt) <span style=color:#66d9ef>end</span>),<span style=color:#ae81ff>1</span>)
</span></span></code></pre></div><p>看看，我们的蛇动起来了！！！</p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=/posts/game/snake-game1/><span class=button__icon>←</span>
<span class=button__text>snake-game1.md</span></a></span>
<span class="button next"><a href=/posts/game/snake-game3/><span class=button__text>snake-game3.md</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>@linuxing3</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=/assets/main.js></script>
<script src=/assets/prism.js></script>
<script src=/assets/languageSelector.js></script></div></body></html>