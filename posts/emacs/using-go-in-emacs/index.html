<!doctype html><html lang=en><head><title>using-go-in-emacs.org :: Vim Emacser Personal Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Some Description"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/posts/emacs/using-go-in-emacs/><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/assets/green.css><link rel=apple-touch-icon href=/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=/img/favicon/green.png><meta name=twitter:card content="summary"><meta name=twitter:site content="https://twitter.com/linuxing3"><meta name=twitter:creator content="Xing Wenju"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="using-go-in-emacs.org"><meta property="og:description" content="Some Description"><meta property="og:url" content="/posts/emacs/using-go-in-emacs/"><meta property="og:site_name" content="Vim Emacser Personal Blog"><meta property="og:image" content="/img/favicon/green.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2018-02-16 20:03:50 -0400 -0400"></head><body class=green><div class="container full"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>Terminal</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/journal>Journal</a></li><li><a href=/showcase>Showcase</a></li><div class=spacer></div><ul class=language-selector><ul class=language-selector-current><li>English ▾</li></ul><ul class="language-selector__more hidden"><li><a href=/>English</a></li><li><a href=/zh/>中文</a></li></ul></ul></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/journal>Journal</a></li><li><a href=/showcase>Showcase</a></li><hr><li><a href=/>English</a></li><li><a href=/zh/>中文</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=/posts/emacs/using-go-in-emacs/>using-go-in-emacs.org</a></h1><div class=post-meta><span class=post-date>2018-02-16</span>
<span class=post-author>:: Xing Wenju</span></div><span class=post-tags>#<a href=/tags/hugo-emacs/>hugo emacs</a>&nbsp;</span><div class=post-content><div><h1 class=title><p>GO layer</p></h1><p><img src=img/go.png alt=img/go.png title=img/go.png></p><div id=outline-container-headline-2 class=outline-2><h2 id=headline-2>Description</h2><div id=outline-text-headline-2 class=outline-text-2><p>This layer adds extensive support for go.</p><div id=outline-container-headline-3 class=outline-3><h3 id=headline-3>Features:</h3><div id=outline-text-headline-3 class=outline-text-3><ul><li>gofmt/goimports on file save</li><li>Auto-completion using <a href=https://github.com/nsf/gocode/tree/master/emacs>go-autocomplete</a> (with the <code class=verbatim>auto-completion</code> layer)</li><li>Source analysis using <a href=https://docs.google.com/document/d/1_Y9xCEMj5S-7rv2ooHpZNH15JgRT5iM742gJkw5LtmQ>go-guru</a></li><li>Refactoring with <a href=http://gorefactor.org/>godoctor</a></li><li>Edit struct field tag with <a href=https://github.com/fatih/gomodifytags>gomodifytags</a></li><li>Linting with flycheck's built-in checkers or flycheck-gometalinter</li><li>Coverage profile visualization</li></ul></div></div></div></div><div id=outline-container-headline-4 class=outline-2><h2 id=headline-4>Install</h2><div id=outline-text-headline-4 class=outline-text-2><div id=outline-container-headline-5 class=outline-3><h3 id=headline-5>Pre-requisites</h3><div id=outline-text-headline-5 class=outline-text-3><p>You will need <code class=verbatim>gocode</code>, <code class=verbatim>godef</code> and <code class=verbatim>godoctor</code>:</p><div class="src src-sh"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>  go get -u -v github.com/nsf/gocode
</span></span><span style=display:flex><span>  go get -u -v github.com/rogpeppe/godef
</span></span><span style=display:flex><span>  go get -u -v golang.org/x/tools/cmd/guru
</span></span><span style=display:flex><span>  go get -u -v golang.org/x/tools/cmd/gorename
</span></span><span style=display:flex><span>  go get -u -v golang.org/x/tools/cmd/goimports</span></span></code></pre></div></div><p>If you wish to use <code class=verbatim>gometalinter</code> set the value of <code class=verbatim>go-use-gometalinter</code> to t:</p><div class="src src-emacs-lisp"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>  (go :variables go-use-gometalinter <span style=color:#66d9ef>t</span>)</span></span></code></pre></div></div><p>and install the tool:</p><div class="src src-sh"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>  go get -u -v github.com/alecthomas/gometalinter
</span></span><span style=display:flex><span>  gometalinter --install --update</span></span></code></pre></div></div><p>For more information read <a href=https://github.com/alecthomas/gometalinter/blob/master/README.md>gometalinter README.md</a>
and <a href=https://github.com/favadi/flycheck-gometalinter/blob/master/README.md>flycheck-gometalinter README.md</a></p><p>If you wish to use <code class=verbatim>godoctor</code> for refactoring, install it too:</p><div class="src src-sh"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>  go get -u -v github.com/godoctor/godoctor
</span></span><span style=display:flex><span>  go install github.com/godoctor/godoctor</span></span></code></pre></div></div><p>If you want to use <code class=verbatim>gomodifytags</code> to edit field tags, install it too:</p><div class="src src-sh"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>  go get -u -v github.com/fatih/gomodifytags</span></span></code></pre></div></div><p>Make sure that the <code class=verbatim>gocode</code> executable is in your PATH. For information about
setting up <code class=verbatim>$PATH</code>, check out the corresponding section in the FAQ (<code>SPC h f
$PATH RET</code>).</p><p>For best results, make sure that the <code class=verbatim>auto-completion</code> and <code class=verbatim>syntax-checking</code>
layers are enabled as well.</p></div></div><div id=outline-container-headline-6 class=outline-3><h3 id=headline-6>Layer</h3><div id=outline-text-headline-6 class=outline-text-3><p>To use this configuration layer, add it to your <code class=verbatim>~/.spacemacs</code>. You will need to
add <code class=verbatim>go</code> to the existing <code class=verbatim>dotspacemacs-configuration-layers</code> list in this
file.</p></div></div></div></div><div id=outline-container-headline-7 class=outline-2><h2 id=headline-7>Configuration</h2><div id=outline-text-headline-7 class=outline-text-2><p>By default, go buffers are run through <code class=verbatim>gofmt</code> on save. To use a different
formatter, set the value of <code class=verbatim>gofmt-command</code>, e.g.</p><div class="src src-emacs-lisp"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>  (setq gofmt-command <span style=color:#e6db74>&#34;goimports&#34;</span>)</span></span></code></pre></div></div><p>or</p><div class="src src-emacs-lisp"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>  (go :variables gofmt-command <span style=color:#e6db74>&#34;goimports&#34;</span>)</span></span></code></pre></div></div><div id=outline-container-headline-8 class=outline-3><h3 id=headline-8>Indentation</h3><div id=outline-text-headline-8 class=outline-text-3><p>By default, the tab width in Go mode is 8 spaces. To use a different value set
the layer variable <code class=verbatim>go-tab-width</code>, e.g.</p><div class="src src-emacs-lisp"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>  (go :variables go-tab-width <span style=color:#ae81ff>4</span>)</span></span></code></pre></div></div></div></div><div id=outline-container-headline-9 class=outline-3><h3 id=headline-9>Tests</h3><div id=outline-text-headline-9 class=outline-text-3><p>If you're using <code class=verbatim>gocheck</code> in your project you can use the
<code class=verbatim>go-use-gocheck-for-testing</code> variable to enable suite testing and to get single
function testing to work.</p><p><code class=verbatim>go-coverage-display-buffer-func</code> controls how <code class=verbatim>go-coverage</code> should display
the coverage buffer. See <a href=https://www.gnu.org/software/emacs/manual/html_node/elisp/Choosing-Window.html><code class=verbatim>display-buffer</code></a> for a list of possible functions.
The default value is <code class=verbatim>display-buffer-reuse-window</code>.</p><p>Tests are run in a compilation buffer displayed in a popup window that can be
closed by pressing <code>C-g</code> from any other window. The variable
<code class=verbatim>go-test-buffer-name</code> can be customized to set the output buffer name.</p><p>To provide additional arguments to go test, specify <code class=verbatim>go-use-test-args</code>.</p><div class="src src-emacs-lisp"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>  (go :variables go-use-test-args <span style=color:#e6db74>&#34;-race -timeout 10s&#34;</span></span></span></code></pre></div></div></div></div><div id=outline-container-headline-10 class=outline-3><h3 id=headline-10>Guru</h3><div id=outline-text-headline-10 class=outline-text-3><p>Go Oracle has been deprecated as of October 1, 2016, it's replacement is <code class=verbatim>go-guru</code>.</p><p>If you would like to use the <code class=verbatim>goguru</code> bindings in your work, you will need to
install it, and in your project you will need to set the scope with <code>SPC m f o</code>.
The scope is a comma separated set of packages, and <code class=verbatim>go</code>'s recursive operator is
supported. In addition, you can prefix with <code class=verbatim>-</code> to exclude a package from
searching.</p><p>In addition, <code class=verbatim>GOPATH</code> must be set prior to <code class=verbatim>go-guru</code> initialization.</p></div></div><div id=outline-container-headline-11 class=outline-3><h3 id=headline-11>Autocomplete</h3><div id=outline-text-headline-11 class=outline-text-3><p><code class=verbatim>gocode</code> uses the output from installed binary files to provide its suggestions.
You have a few options to ensure you always get up to date suggestions:</p><ul><li>Run <code class=verbatim>go install ./...</code> in your package directory when you make a file change.</li><li>Run <code class=verbatim>gocode set autobuild true</code> to have gocode attempt to run <code class=verbatim>go install
./...</code> for you.</li><li>You can configure your task runner to run <code class=verbatim>go install ./...</code> command on every
file change.</li></ul></div></div></div></div><div id=outline-container-headline-12 class=outline-2><h2 id=headline-12>Working with Go</h2><div id=outline-text-headline-12 class=outline-text-2><div id=outline-container-headline-13 class=outline-3><h3 id=headline-13>Go commands (start with <code class=verbatim>m</code>):</h3><div id=outline-text-headline-13 class=outline-text-3><table><thead><tr><th>Key Binding</th><th>Description</th></tr></thead><tbody><tr><td><code>SPC m e b</code></td><td>go-play buffer</td></tr><tr><td><code>SPC m e d</code></td><td>download go-play snippet</td></tr><tr><td><code>SPC m e r</code></td><td>go-play region</td></tr><tr><td><code>SPC m g a</code></td><td>jump to matching test file or back from test to code file</td></tr><tr><td><code>SPC m g c</code></td><td>open a clone of the current buffer with a coverage info (<code class=verbatim>go tool cover -h</code> for help)</td></tr><tr><td><code>SPC m g g</code></td><td>go jump to definition</td></tr><tr><td><code>SPC m i a</code></td><td>add import</td></tr><tr><td><code>SPC m i g</code></td><td>goto imports</td></tr><tr><td><code>SPC m i r</code></td><td>remove unused import</td></tr><tr><td><code>SPC m h h</code></td><td>godoc at point</td></tr><tr><td><code>SPC m r n</code></td><td>go rename</td></tr><tr><td><code>SPC m t p</code></td><td>run "go test" for the current package</td></tr><tr><td><code>SPC m t P</code></td><td>run "go test" for the current package and all packages under it</td></tr><tr><td><code>SPC m t s</code></td><td>run "go test" for the suite you're currently in (requires gocheck)</td></tr><tr><td><code>SPC m t t</code></td><td>run "go test" for the function you're currently in (while you're in a _.test.go file)</td></tr><tr><td><code>SPC m x x</code></td><td>run "go run" for the current 'main' package</td></tr></tbody></table></div></div><div id=outline-container-headline-14 class=outline-3><h3 id=headline-14>Go Guru</h3><div id=outline-text-headline-14 class=outline-text-3><table><thead><tr><th>Key Binding</th><th>Description</th></tr></thead><tbody><tr><td><code>SPC m f &lt;</code></td><td>go-guru show possible callers</td></tr><tr><td><code>SPC m f ></code></td><td>go-guru show call targets</td></tr><tr><td><code>SPC m f c</code></td><td>go-guru show channel sends/receives</td></tr><tr><td><code>SPC m f d</code></td><td>go-guru describe symbol at point</td></tr><tr><td><code>SPC m f e</code></td><td>go-guru show possible contants/types for error value</td></tr><tr><td><code>SPC m f f</code></td><td>go-guru show free variables</td></tr><tr><td><code>SPC m f i</code></td><td>go-guru show implements relation</td></tr><tr><td><code>SPC m f j</code></td><td>go-guru jump to symbol definition</td></tr><tr><td><code>SPC m f o</code></td><td>go-guru set analysis scope</td></tr><tr><td><code>SPC m f p</code></td><td>go-guru show what the select expression points to</td></tr><tr><td><code>SPC m f r</code></td><td>go-guru show referrers</td></tr><tr><td><code>SPC m f s</code></td><td>go-guru show callstack</td></tr></tbody></table></div></div><div id=outline-container-headline-15 class=outline-3><h3 id=headline-15>Refactoring</h3><div id=outline-text-headline-15 class=outline-text-3><table><thead><tr><th>Key Binding</th><th>Description</th></tr></thead><tbody><tr><td><code>SPC m r d</code></td><td>Add comment stubs</td></tr><tr><td><code>SPC m r e</code></td><td>Extract code as new function</td></tr><tr><td><code>SPC m r f</code></td><td>Add field tags</td></tr><tr><td><code>SPC m r F</code></td><td>Remove field tags</td></tr><tr><td><code>SPC m r n</code></td><td>Rename (with <code class=verbatim>godoctor</code>)</td></tr><tr><td><code>SPC m r N</code></td><td>Rename (with <code class=verbatim>go-rename</code>)</td></tr><tr><td><code>SPC m r t</code></td><td>Toggle declaration and assignment</td></tr></tbody></table></div></div></div></div></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=/posts/emacs/using-dotemacs-in-emacs/><span class=button__icon>←</span>
<span class=button__text>using-dotemacs-in-emacs.org</span></a></span>
<span class="button next"><a href=/posts/emacs/using-hugo-in-emacs/><span class=button__text>using-hugo-in-emacs.org</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>@linuxing3</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=/assets/main.js></script>
<script src=/assets/prism.js></script>
<script src=/assets/languageSelector.js></script></div></body></html>