<!doctype html><html lang=en><head><title>using-javascript-in-emacs.org :: Vim Emacser Personal Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Some Description"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/posts/emacs/using-javascript-in-emacs/><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/assets/green.css><link rel=apple-touch-icon href=/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=/img/favicon/green.png><meta name=twitter:card content="summary"><meta name=twitter:site content="https://twitter.com/linuxing3"><meta name=twitter:creator content="Xing Wenju"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="using-javascript-in-emacs.org"><meta property="og:description" content="Some Description"><meta property="og:url" content="/posts/emacs/using-javascript-in-emacs/"><meta property="og:site_name" content="Vim Emacser Personal Blog"><meta property="og:image" content="/img/favicon/green.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2018-02-16 20:03:50 -0400 -0400"></head><body class=green><div class="container full"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>Terminal</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/journal>Journal</a></li><li><a href=/showcase>Showcase</a></li><div class=spacer></div><ul class=language-selector><ul class=language-selector-current><li>English ▾</li></ul><ul class="language-selector__more hidden"><li><a href=/>English</a></li><li><a href=/zh/>中文</a></li></ul></ul></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/journal>Journal</a></li><li><a href=/showcase>Showcase</a></li><hr><li><a href=/>English</a></li><li><a href=/zh/>中文</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=/posts/emacs/using-javascript-in-emacs/>using-javascript-in-emacs.org</a></h1><div class=post-meta><span class=post-date>2018-02-16</span>
<span class=post-author>:: Xing Wenju</span></div><span class=post-tags>#<a href=/tags/hugo-emacs/>hugo emacs</a>&nbsp;</span><div class=post-content><div><div id=outline-container-headline-1 class=outline-3><h3 id=headline-1>Day 2</h3><div id=outline-text-headline-1 class=outline-text-3><div id=outline-container-headline-2 class=outline-4><h4 id=headline-2>Javascript mode of emacs</h4></div><div id=outline-container-headline-3 class=outline-4><h4 id=headline-3>Description</h4><div id=outline-text-headline-3 class=outline-text-4><p>This layer adds support for the JavaScript language using <a href=https://github.com/mooz/js2-mode>js2-mode</a>.</p><div id=outline-container-headline-4 class=outline-5><h5 id=headline-4>Features:</h5><div id=outline-text-headline-4 class=outline-text-5><ul><li>Smart code folding</li><li>Refactoring: done using [[<a href=https://github.com/magnars/js2-refactor.el][]js2-refactor].>https://github.com/magnars/js2-refactor.el][]js2-refactor].</a></li><li>Auto-completion and documentation: provided by <a href=http://ternjs.net/>tern</a></li><li>CoffeeScript support</li><li>Formatting with <a href=https://github.com/yasuyk/web-beautify>web-beautify</a></li><li>Get the path to a JSON value with <a href=https://github.com/Sterlingg/json-snatcher>json-snatcher</a></li><li>REPL available via <a href=https://github.com/skeeto/skewer-mode>skewer-mode</a> and <a href=https://github.com/pandeiro/livid-mode>livid-mode</a></li></ul></div></div></div></div><div id=outline-container-headline-5 class=outline-4><h4 id=headline-5>Install</h4><div id=outline-text-headline-5 class=outline-text-4><p>To use this configuration layer, add it to your <code class=verbatim>~/.spacemacs</code>. You will need to
add <code class=verbatim>javascript</code> to the existing <code class=verbatim>dotspacemacs-configuration-layers</code> list in
this file.</p><p>You will also need to install <code class=verbatim>tern</code> to use the auto-completion and
documentation features:</p><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e>#+BEGIN_SRC sh</span>
</span></span><span style=display:flex><span>	$ npm install -g tern
</span></span><span style=display:flex><span><span style=color:#75715e>#+END_SRC</span></span></span></code></pre></div></p><p>To use the formatting features, install <code class=verbatim>js-beautify</code>:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e>#+BEGIN_SRC sh</span>
</span></span><span style=display:flex><span>	$ npm install -g js-beautify
</span></span><span style=display:flex><span><span style=color:#75715e>#+END_SRC</span></span></span></code></pre></div></p><p>To activate error checking using flycheck, install one of the <a href=http://www.flycheck.org/en/latest/languages.html#javascript>available linters</a>
such as <code class=verbatim>ESLint</code> or <code class=verbatim>JSHint</code>:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e>#+BEGIN_SRC sh</span>
</span></span><span style=display:flex><span>	$ npm install -g eslint
</span></span><span style=display:flex><span>	<span style=color:#75715e># or</span>
</span></span><span style=display:flex><span>	$ npm install -g jshint
</span></span><span style=display:flex><span><span style=color:#75715e>#+END_SRC</span></span></span></code></pre></div></p></div></div><div id=outline-container-headline-6 class=outline-4><h4 id=headline-6>Configuration</h4><div id=outline-text-headline-6 class=outline-text-4><div id=outline-container-headline-7 class=outline-5><h5 id=headline-7>Tern</h5><div id=outline-text-headline-7 class=outline-text-5><p>To make tern re-use the server across multiple different editing sessions (thus
creating multiple <code class=verbatim>.tern-port</code> files for each document you have open <a href=http://ternjs.net/doc/manual.html>see here
for more details</a>):</p><p>The variables provided below can be set when adding the <code class=verbatim>javascript</code>
configuration layer, as detailed in <a href=../../../doc/DOCUMENTATION.org::Setting%20configuration%20layers%20variables>this</a> section of the documentation.</p><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span>+BEGIN_SRC emacs-lisp
</span></span><span style=display:flex><span>	(javascript :variables javascript-disable-tern-port-files <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span>+END_SRC</span></span></code></pre></div></p><p>Windows users may need to set the variable <code class=verbatim>tern-command</code> in order for emacs to
locate and launch tern server successfully. See <a href=https://github.com/syl20bnr/spacemacs/issues/5733>this open issue for more
details</a>. The variable can be set when adding the <code class=verbatim>javascript</code> configuration
layer:</p><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span>+BEGIN_SRC emacs-lisp
</span></span><span style=display:flex><span>	(javascript :variables tern-command <span style=color:#f92672>&#39;</span>(<span style=color:#e6db74>&#34;node&#34;</span> <span style=color:#e6db74>&#34;/path/to/tern/bin/tern&#34;</span>))
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span>+END_SRC</span></span></code></pre></div></p></div></div><div id=outline-container-headline-8 class=outline-5><h5 id=headline-8>Indentation</h5><div id=outline-text-headline-8 class=outline-text-5><p>To change how js2-mode indents code, set the variable <code class=verbatim>js2-basic-offset</code>, as
such:</p><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span>+BEGIN_SRC emacs-lisp
</span></span><span style=display:flex><span>	(setq-default js2-basic-offset <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span>+END_SRC</span></span></code></pre></div></p><p>Similarly, to change how js-mode indents JSON files, set the variable
<code class=verbatim>js-indent-level</code>, as such:</p><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span>+BEGIN_SRC emacs-lisp
</span></span><span style=display:flex><span>	(setq-default js-indent-level <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span>+END_SRC</span></span></code></pre></div></p></div></div><div id=outline-container-headline-9 class=outline-5><h5 id=headline-9>REPL</h5><div id=outline-text-headline-9 class=outline-text-5><p>To use the available JS repl, you need a running httpd server and a page loaded
with skewer. If a blank page serves your needs, just use the run-skewer command
in your javascript buffer. If you want to inject it in your own page, follow
<a href=https://github.com/skeeto/skewer-mode#skewering-with-cors>these instructions</a> (install the Greasemonkey script and then click the triangle
in the top-right corner - if it turns green, you're good to go).</p></div></div></div></div><div id=outline-container-headline-10 class=outline-4><h4 id=headline-10>Key Bindings</h4><div id=outline-text-headline-10 class=outline-text-4><div id=outline-container-headline-11 class=outline-5><h5 id=headline-11>js2-mode</h5><div id=outline-text-headline-11 class=outline-text-5><table><thead><tr><th>Key Binding</th><th>Description</th></tr></thead><tbody><tr><td><code>SPC m w</code></td><td>toggle js2-mode warnings and errors</td></tr><tr><td><code>%</code></td><td>jump between blockswith <a href=https://github.com/redguardtoo/evil-matchit>evil-matchit</a></td></tr></tbody></table></div></div><div id=outline-container-headline-12 class=outline-5><h5 id=headline-12>Folding (js2-mode)</h5><div id=outline-text-headline-12 class=outline-text-5><table><thead><tr><th>Key Binding</th><th>Description</th></tr></thead><tbody><tr><td><code>SPC m z c</code></td><td>zipcode 隐藏元素 hide element</td></tr><tr><td><code>SPC m z o</code></td><td>zipopen 显示元素 show element</td></tr><tr><td><code>SPC m z r</code></td><td>全部显示 show all element</td></tr><tr><td><code>SPC m z e</code></td><td>切换元素 toggle hide/show element</td></tr><tr><td><code>SPC m z F</code></td><td>切换函数 toggle hide functions</td></tr><tr><td><code>SPC m z C</code></td><td>切换注释 toggle hide comments</td></tr></tbody></table></div></div><div id=outline-container-headline-13 class=outline-5><h5 id=headline-13>Refactoring (js2-refactor)</h5><div id=outline-text-headline-13 class=outline-text-5><p>Bindings should match the plain emacs assignments.</p><table><thead><tr><th>Key Binding</th><th>Description</th></tr></thead><tbody><tr><td><code>SPC m k</code></td><td>删除到行尾 deletes to the end of the line, but does not cross semantic boundaries</td></tr></tbody><tbody><tr><td><code>SPC m r 3 i</code></td><td>converts ternary operator to if-statement</td></tr><tr><td><code>SPC m r a g</code></td><td>creates a <code class=verbatim>/* global */</code> annotation if it is missing, and adds var to point to it</td></tr><tr><td><code>SPC m r a o</code></td><td>命名参数 replaces arguments to a function call with an object literal of named arguments</td></tr><tr><td><code>SPC m r b a</code></td><td>moves the last child out of current function, if-statement, for-loop or while-loop</td></tr></tbody><tbody><tr><td><code>SPC m r c a</code></td><td>多行数组合并 converts a multiline array to one line</td></tr><tr><td><code>SPC m r c o</code></td><td>多行对象合并 converts a multiline object literal to one line</td></tr><tr><td><code>SPC m r c u</code></td><td>多行函数合并 converts a multiline function to one line (expecting semicolons as statement delimiters)</td></tr></tbody><tbody><tr><td><code>SPC m r e a</code></td><td>单行数组拆分多行 converts a one line array to multiline</td></tr><tr><td><code>SPC m r e f</code></td><td>表达式转命名函数 extracts the marked expressions into a new named function</td></tr><tr><td><code>SPC m r e m</code></td><td>表达式转新方法 extracts the marked expressions out into a new method in an object literal</td></tr><tr><td><code>SPC m r e o</code></td><td>单行对象转多行 converts a one line object literal to multiline</td></tr><tr><td><code>SPC m r e u</code></td><td>单行函数转多行 converts a one line function to multiline (expecting semicolons as statement delimiters)</td></tr><tr><td><code>SPC m r e v</code></td><td>将表达式转为变量 takes a marked expression and replaces it with a var</td></tr></tbody><tbody><tr><td><code>SPC m r i g</code></td><td>creates a shortcut for a marked global by injecting it in the wrapping immediately invoked function expression</td></tr><tr><td><code>SPC m r i p</code></td><td>changes the marked expression to a parameter in a local function</td></tr><tr><td><code>SPC m r i v</code></td><td>replaces all instances of a variable with its initial value</td></tr></tbody><tbody><tr><td><code>SPC m r l p</code></td><td>参数转本地变量 changes a parameter to a local var in a local function</td></tr><tr><td><code>SPC m r l t</code></td><td>添加终端日志 adds a console.log statement for what is at point (or region)</td></tr></tbody><tbody><tr><td><code>SPC m r r v</code></td><td>重命名全部变量 renames the variable on point and all occurrences in its lexical scope</td></tr></tbody><tbody><tr><td><code>SPC m r s l</code></td><td>moves the next statement into current function, if-statement, for-loop, while-loop</td></tr></tbody><tbody><tr><td><code>SPC m r s s</code></td><td>拆分字符串 splits a <code class=verbatim>String</code></td></tr><tr><td><code>SPC m r s v</code></td><td>拆分变量 splits a <code class=verbatim>var</code> with multiple vars declared into several <code class=verbatim>var</code> statements</td></tr></tbody><tbody><tr><td><code>SPC m r t f</code></td><td>切换函数声明和表达式 toggle between function declaration and function expression</td></tr><tr><td><code>SPC m r u w</code></td><td>replaces the parent statement with the selected region</td></tr><tr><td><code>SPC m r v t</code></td><td>changes local <code class=verbatim>var a</code> to be <code class=verbatim>this.a</code> instead</td></tr></tbody><tbody><tr><td><code>SPC m r w i</code></td><td>整个缓冲区转立即运行函数表达式 wraps the entire buffer in an immediately invoked function expression</td></tr><tr><td><code>SPC m r w l</code></td><td>选定区域转 for 循环 wraps the region in a for-loop</td></tr><tr><td><code>SPC m x m j</code></td><td>下移一行 move line down, while keeping commas correctly placed</td></tr><tr><td><code>SPC m x m k</code></td><td>上移一行 move line up, while keeping commas correctly placed</td></tr></tbody></table></div></div><div id=outline-container-headline-14 class=outline-5><h5 id=headline-14>Formatting (web-beautify)</h5><div id=outline-text-headline-14 class=outline-text-5><table><thead><tr><th>Key Binding</th><th>Description</th></tr></thead><tbody><tr><td><code>SPC m =</code></td><td>美化格式 beautify code in js2-mode, json-mode, web-mode, and css-mode</td></tr></tbody></table><div id=outline-container-headline-15 class=outline-6><h6 id=headline-15>Documentation (js-doc)</h6><div id=outline-text-headline-15 class=outline-text-6><p>You can check more <a href=https://github.com/mooz/js-doc/>here</a></p><table><thead><tr><th>Key Binding</th><th>Description</th></tr></thead><tbody><tr><td><code>SPC m r d b</code></td><td>插入文件注释 insert JSDoc comment for current file</td></tr><tr><td><code>SPC m r d f</code></td><td>插入函数注释 insert JSDoc comment for function</td></tr><tr><td><code>SPC m r d t</code></td><td>插入注释标签 insert tag to comment</td></tr><tr><td><code>SPC m r d h</code></td><td>显示可用注释标签 show list of available jsdoc tags</td></tr></tbody></table></div></div></div></div><div id=outline-container-headline-16 class=outline-5><h5 id=headline-16>Auto-complete and documentation (tern)</h5><div id=outline-text-headline-16 class=outline-text-5><table><thead><tr><th>Key Binding</th><th>Description</th></tr></thead><tbody><tr><td><code>SPC m C-g</code></td><td>brings you back to last place you were when you pressed M-..</td></tr><tr><td><code>SPC m g g</code></td><td>跳转定义 jump to the definition of the thing under the cursor</td></tr><tr><td><code>SPC m g G</code></td><td>给定名称，跳转到定义 jump to definition for the given name</td></tr><tr><td><code>SPC m h d</code></td><td>查找文档 find docs of the thing under the cursor. Press again to open the associated URL (if any)</td></tr><tr><td><code>SPC m h t</code></td><td>检查类型 find the type of the thing under the cursor</td></tr><tr><td><code>SPC m r r V</code></td><td>重命名变量 rename variable under the cursor using tern</td></tr></tbody></table></div></div><div id=outline-container-headline-17 class=outline-5><h5 id=headline-17>JSON</h5><div id=outline-text-headline-17 class=outline-text-5><table><thead><tr><th>Key Binding</th><th>Description</th></tr></thead><tbody><tr><td><code>SPC m h p</code></td><td>Get the path of the value at point</td></tr></tbody></table></div></div><div id=outline-container-headline-18 class=outline-5><h5 id=headline-18>REPL (skewer-mode)</h5><div id=outline-text-headline-18 class=outline-text-5><table><thead><tr><th>Key Binding</th><th>Description</th></tr></thead><tbody><tr><td><code>SPC m e e</code></td><td>评估最后表达式 evaluates the last expression</td></tr><tr><td><code>SPC m e E</code></td><td>评估并插入结果 evaluates and inserts the result of the last expression at point</td></tr></tbody></table><table><thead><tr><th>Key Binding</th><th>Description</th></tr></thead><tbody><tr><td><code>SPC m s a</code></td><td>切换热更新测试 Toggle live evaluation of whole buffer in REPL on buffer changes</td></tr><tr><td><code>SPC m s b</code></td><td>将整个缓冲区内容发往测试 send current buffer contents to the skewer REPL</td></tr><tr><td><code>SPC m s B</code></td><td>将整个缓冲区发往测试，转入插入模式 send current buffer contents to the skewer REPL and switch to it in insert state</td></tr><tr><td><code>SPC m s i</code></td><td>启动到测试平台 starts/switch to the skewer REPL</td></tr><tr><td><code>SPC m s r</code></td><td>发送选定区域进行测试 send current region to the skewer REPL</td></tr><tr><td><code>SPC m s R</code></td><td>发送选定区域进行测试，切换到插入模式 send current region to the skewer REPL and switch to it in insert state</td></tr><tr><td><code>SPC m s s</code></td><td>切换到测试区域 switch to REPL</td></tr></tbody></table><p>To be continued…</p></div></div></div></div></div></div></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=/posts/emacs/using-java-in-emacs/><span class=button__icon>←</span>
<span class=button__text>using-java-in-emacs.org</span></a></span>
<span class="button next"><a href=/posts/emacs/using-lua-in-emacs/><span class=button__text>using-lua-in-emacs.org</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>@linuxing3</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=/assets/main.js></script>
<script src=/assets/prism.js></script>
<script src=/assets/languageSelector.js></script></div></body></html>