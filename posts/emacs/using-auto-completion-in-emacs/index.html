<!doctype html><html lang=en><head><title>using-auto-completion-in-emacs.org :: Vim Emacser Personal Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Some Description"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/posts/emacs/using-auto-completion-in-emacs/><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/assets/green.css><link rel=apple-touch-icon href=/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=/img/favicon/green.png><meta name=twitter:card content="summary"><meta name=twitter:site content="https://twitter.com/linuxing3"><meta name=twitter:creator content="Xing Wenju"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="using-auto-completion-in-emacs.org"><meta property="og:description" content="Some Description"><meta property="og:url" content="/posts/emacs/using-auto-completion-in-emacs/"><meta property="og:site_name" content="Vim Emacser Personal Blog"><meta property="og:image" content="/img/favicon/green.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2018-02-16 20:03:50 -0400 -0400"></head><body class=green><div class="container full"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>Terminal</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/journal>Journal</a></li><li><a href=/showcase>Showcase</a></li><div class=spacer></div><ul class=language-selector><ul class=language-selector-current><li>English ▾</li></ul><ul class="language-selector__more hidden"><li><a href=/>English</a></li><li><a href=/zh/>中文</a></li></ul></ul></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/journal>Journal</a></li><li><a href=/showcase>Showcase</a></li><hr><li><a href=/>English</a></li><li><a href=/zh/>中文</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=/posts/emacs/using-auto-completion-in-emacs/>using-auto-completion-in-emacs.org</a></h1><div class=post-meta><span class=post-date>2018-02-16</span>
<span class=post-author>:: Xing Wenju</span></div><span class=post-tags>#<a href=/tags/hugo-emacs/>hugo emacs</a>&nbsp;</span><div class=post-content><div><div id=outline-container-headline-2 class=outline-2><h2 id=headline-2>Description</h2><div id=outline-text-headline-2 class=outline-text-2><p>This layer provides auto-completion to Spacemacs.</p><p>The following completion engines are supported:</p><ul><li><a href=http://company-mode.github.io/>company</a></li><li><a href=https://github.com/auto-complete/auto-complete>auto-complete</a></li></ul><p>Snippets are supported via <a href=https://github.com/capitaomorte/yasnippet>yasnippet</a> and <a href=https://github.com/abo-abo/auto-yasnippet>auto-yasnippet</a>.</p><p>This layer also configures <code class=verbatim>hippie-expand</code>.</p><div id=outline-container-headline-3 class=outline-3><h3 id=headline-3>Features:</h3><div id=outline-text-headline-3 class=outline-text-3><ul><li>Completion with <code class=verbatim>company</code> or <code class=verbatim>auto-complete</code></li><li>Frequency-based suggestions via <code class=verbatim>company-statistics</code></li><li>Integration with <code class=verbatim>yasnippets</code></li></ul></div></div></div></div><div id=outline-container-headline-4 class=outline-2><h2 id=headline-4>Install</h2><div id=outline-text-headline-4 class=outline-text-2><p>To use this configuration layer, add it to your <code class=verbatim>~/.spacemacs</code>. You will need to
add <code class=verbatim>auto-completion</code> to the existing <code class=verbatim>dotspacemacs-configuration-layers</code> list in this
file.</p></div></div><div id=outline-container-headline-5 class=outline-2><h2 id=headline-5>Configuration</h2><div id=outline-text-headline-5 class=outline-text-2><div id=outline-container-headline-6 class=outline-3><h3 id=headline-6>Key bindings</h3><div id=outline-text-headline-6 class=outline-text-3><p>You can customize the user experience of auto-completion with the following
layer variables:</p><ol><li><p><code class=verbatim>auto-completion-return-key-behavior</code> set the action to perform when the
<code>RET</code> key is pressed, the possible values are:</p><ul><li><code class=verbatim>complete</code> completes with the current selection</li><li><code class=verbatim>nil</code> does nothing</li></ul></li><li><p><code class=verbatim>auto-completion-tab-key-behavior</code> set the action to perform when the <code>TAB</code>
key is pressed, the possible values are:</p><ul><li><code class=verbatim>complete</code> completes with the current selection</li><li><code class=verbatim>cycle</code> completes the common prefix and cycle between candidates</li><li><code class=verbatim>nil</code> does nothing</li></ul></li><li><code class=verbatim>auto-completion-complete-with-key-sequence</code> is a string of two characters
denoting a key sequence that will perform a <code class=verbatim>complete</code> action if the sequence
as been entered quickly enough. If its value is <code class=verbatim>nil</code> then the feature is
disabled.</li><li><code class=verbatim>auto-completion-complete-with-key-sequence-delay</code> is the number of seconds
to wait for the auto-completion key sequence to be entered. The default value
is 0.1 seconds.</li><li><code class=verbatim>auto-completion-idle-delay</code> is the number of seconds to wait before
suggesting completions. The default value is 0.2 seconds.</li></ol><p>The default configuration of the layer is:</p><div class="src src-emacs-lisp"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(setq-default dotspacemacs-configuration-layers <span style=color:#f92672>&#39;</span>(
</span></span><span style=display:flex><span>  (auto-completion :variables
</span></span><span style=display:flex><span>                   auto-completion-return-key-behavior <span style=color:#e6db74>&#39;complete</span>
</span></span><span style=display:flex><span>                   auto-completion-tab-key-behavior <span style=color:#e6db74>&#39;cycle</span>
</span></span><span style=display:flex><span>                   auto-completion-complete-with-key-sequence <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>                   auto-completion-complete-with-key-sequence-delay <span style=color:#ae81ff>0.1</span>
</span></span><span style=display:flex><span>                   auto-completion-idle-delay <span style=color:#ae81ff>0.2</span>
</span></span><span style=display:flex><span>                   auto-completion-private-snippets-directory <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>                   ))</span></span></code></pre></div></div><p><code>jk</code> is a good candidate for <code class=verbatim>auto-completion-complete-with-key-sequence</code> if
you don't use it already.</p></div></div><div id=outline-container-headline-7 class=outline-3><h3 id=headline-7>Snippets directories</h3><div id=outline-text-headline-7 class=outline-text-3><p>The following directories are added by default:</p><ul><li><code class=verbatim>~/.emacs.d/elpa/yasnippet-xxxxx/snippets</code></li><li><code class=verbatim>~/.emacs.d/layers/auto-completion/snippets</code></li><li><code class=verbatim>~/.emacs.d/private/snippets</code> (conditional to the value of <code class=verbatim>auto-completion-private-snippets-directory</code>)</li><li><code class=verbatim>~/.spacemacs.d/snippets</code> (conditional to the existence of <code class=verbatim>~/.spacemacs.d</code> directory)</li></ul><p>You can provide additional directories by setting the variable
<code class=verbatim>auto-completion-private-snippets-directory</code> which can take a string in case of
a single path or a list of paths.
If its value is <code class=verbatim>nil</code> then the path <code class=verbatim>~/.emacs.d/private/snippets</code> is used.</p></div></div><div id=outline-container-headline-8 class=outline-3><h3 id=headline-8>Show snippets in auto-completion popup</h3><div id=outline-text-headline-8 class=outline-text-3><p>By default, snippets are not shown in the auto-completion popup. To show them in
the popup, set the variable <code class=verbatim>auto-completion-enable-snippets-in-popup</code> to <code class=verbatim>t</code>.</p><div class="src src-emacs-lisp"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>  (setq-default dotspacemacs-configuration-layers
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#39;</span>((auto-completion :variables
</span></span><span style=display:flex><span>                                   auto-completion-enable-snippets-in-popup <span style=color:#66d9ef>t</span>)))</span></span></code></pre></div></div></div></div><div id=outline-container-headline-9 class=outline-3><h3 id=headline-9>Tooltips</h3><div id=outline-text-headline-9 class=outline-text-3><p>To enable automatic docstring tooltips set <code class=verbatim>auto-completion-enable-help-tooltip</code>
to <code class=verbatim>t</code>.</p><div class="src src-emacs-lisp"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(setq-default dotspacemacs-configuration-layers
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#39;</span>((auto-completion :variables
</span></span><span style=display:flex><span>                    auto-completion-enable-help-tooltip <span style=color:#66d9ef>t</span>)))</span></span></code></pre></div></div><p>To enable manual non-automatic invocation of docstring tooltips, set it to
<code class=verbatim>manual</code>. The tooltip can be invoked manually by pressing <code>M-h</code>.</p><div class="src src-emacs-lisp"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(setq-default dotspacemacs-configuration-layers
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#39;</span>((auto-completion :variables
</span></span><span style=display:flex><span>                    auto-completion-enable-help-tooltip <span style=color:#e6db74>&#39;manual</span>)))</span></span></code></pre></div></div></div></div><div id=outline-container-headline-10 class=outline-3><h3 id=headline-10>Sort results by usage</h3><div id=outline-text-headline-10 class=outline-text-3><p>To enable sorting auto-completion results by their usage frequency set
<code class=verbatim>auto-completion-enable-sort-by-usage</code> to <code class=verbatim>t</code>.
This feature is provided by the <a href=https://github.com/company-mode/company-statistics>company-statistics</a> package when <code class=verbatim>company</code>
is used.
The variable has no effect when <code class=verbatim>auto-complete</code> is used.</p><div class="src src-emacs-lisp"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(setq-default dotspacemacs-configuration-layers
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#39;</span>((auto-completion :variables
</span></span><span style=display:flex><span>                    auto-completion-enable-sort-by-usage <span style=color:#66d9ef>t</span>)))</span></span></code></pre></div></div></div></div><div id=outline-container-headline-11 class=outline-3><h3 id=headline-11>Enable company or auto-complete globally</h3><div id=outline-text-headline-11 class=outline-text-3><p>By default Spacemacs enables auto-completion explicitly for each supported
major-mode, it means that <code class=verbatim>company</code> and <code class=verbatim>auto-complete</code> are not enabled
globally, it allows more flexibility to choose an auto-completion engine
for a given mode.</p><p>You may want to enable company globally to get auto-completion
everywhere even in the modes which are not configured by Spacemacs. To do
so, you just have to add <code class=verbatim>(global-company-mode)</code> in the
<code class=verbatim>dotspacemacs/user-config</code> function of your dotfile.</p><p>Note that if you want to enable <code class=verbatim>auto-complete</code> globally you will have to
disable <code class=verbatim>company</code> first, see the next section to do so.</p></div></div><div id=outline-container-headline-12 class=outline-3><h3 id=headline-12>Replacing company by auto-complete</h3><div id=outline-text-headline-12 class=outline-text-3><p>You can disable <code class=verbatim>company</code> by adding it to the <code class=verbatim>dotspacemacs-excluded-packages</code>
variable, then you are free to enable <code class=verbatim>auto-complete</code> globally.</p></div></div><div id=outline-container-headline-13 class=outline-3><h3 id=headline-13>Add auto-completion in a layer</h3><div id=outline-text-headline-13 class=outline-text-3><p>Here is an example to add <code class=verbatim>company</code> auto-completion to python buffers via the
package <code class=verbatim>company-anaconda</code>.</p><p>In the file <code class=verbatim>packages.el</code> of the python layer:</p><div class="src src-emacs-lisp"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>  <span style=color:#75715e>;; Add the relevant packages to the layer</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>;; here it is `company-anaconda&#39;</span>
</span></span><span style=display:flex><span>  (setq python-packages
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#39;</span>(<span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>      (company-anaconda :toggle (configuration-layer/package-used-p <span style=color:#e6db74>&#39;company</span>))
</span></span><span style=display:flex><span>      <span style=color:#f92672>...</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (defun python/init-company-anaconda ()
</span></span><span style=display:flex><span>    (use-package company-anaconda
</span></span><span style=display:flex><span>      :defer <span style=color:#66d9ef>t</span>
</span></span><span style=display:flex><span>      :init
</span></span><span style=display:flex><span>      (spacemacs|add-company-backends
</span></span><span style=display:flex><span>         :backends company-anaconda
</span></span><span style=display:flex><span>         :modes python-mode)))</span></span></code></pre></div></div></div></div><div id=outline-container-headline-14 class=outline-3><h3 id=headline-14>Completion back ends</h3><div id=outline-text-headline-14 class=outline-text-3><p>Many spacemacs layers (e.g., python, html, haskell) configure company mode
backends to provide mode-specific completion. These modes will include
completion backends specified in the `spacemacs-default-company-backends`
variable. The defaults should work well, but you can configure this variable in
your <code class=verbatim>.spacemacs</code> file with (e.g.)</p><div class="src src-emacs-lisp"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>  (setq-default
</span></span><span style=display:flex><span>   dotspacemacs-configuration-layers
</span></span><span style=display:flex><span>   <span style=color:#f92672>&#39;</span>((auto-completion :variables
</span></span><span style=display:flex><span>                      spacemacs-default-company-backends <span style=color:#f92672>&#39;</span>(company-files company-capf))))</span></span></code></pre></div></div></div></div><div id=outline-container-headline-15 class=outline-3><h3 id=headline-15>Improved faces</h3><div id=outline-text-headline-15 class=outline-text-3><p>For nicer-looking faces, try adding the following to `custom-set-faces` in your dotspacemacs file.</p><div class="src src-emacs-lisp"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(custom-set-faces
</span></span><span style=display:flex><span> <span style=color:#f92672>&#39;</span>(company-tooltip-common
</span></span><span style=display:flex><span>   ((<span style=color:#66d9ef>t</span> (:inherit company-tooltip :weight bold :underline <span style=color:#66d9ef>nil</span>))))
</span></span><span style=display:flex><span> <span style=color:#f92672>&#39;</span>(company-tooltip-common-selection
</span></span><span style=display:flex><span>   ((<span style=color:#66d9ef>t</span> (:inherit company-tooltip-selection :weight bold :underline <span style=color:#66d9ef>nil</span>)))))</span></span></code></pre></div></div></div></div></div></div><div id=outline-container-headline-16 class=outline-2><h2 id=headline-16>Key Bindings</h2><div id=outline-text-headline-16 class=outline-text-2><div id=outline-container-headline-17 class=outline-3><h3 id=headline-17>Company</h3><div id=outline-text-headline-17 class=outline-text-3><table><thead><tr><th>Key Binding</th><th>Description</th></tr></thead><tbody><tr><td><code>C-d</code></td><td>open minibuffer with documentation of thing at point in company dropdown</td></tr><tr><td><code>C-/</code></td><td>show candidates in Helm (for fuzzy searching)</td></tr><tr><td><code>C-M-/</code></td><td>filter the company dropdown menu</td></tr><tr><td><code>M-h</code></td><td>show current candidate's documentation in a tooltip (requires <code class=verbatim>auto-completion-enable-help-tooltip</code>)</td></tr></tbody></table><p>Vim Style:</p><table><thead><tr><th>Key Binding</th><th>Description</th></tr></thead><tbody><tr><td><code>C-j</code></td><td>(vim style) go down in company dropdown menu</td></tr><tr><td><code>C-k</code></td><td>(vim style) go up in company dropdown menu</td></tr><tr><td><code>C-l</code></td><td>(vim style) complete selection</td></tr></tbody></table><p>Emacs style:</p><table><thead><tr><th>Key Binding</th><th>Description</th></tr></thead><tbody><tr><td><code>C-n</code></td><td>(emacs style) go down in company dropdown menu</td></tr><tr><td><code>C-p</code></td><td>(emacs style) go up in company dropdown menu</td></tr></tbody></table></div></div><div id=outline-container-headline-18 class=outline-3><h3 id=headline-18>Auto-complete</h3><div id=outline-text-headline-18 class=outline-text-3><table><thead><tr><th>Key Binding</th><th>Description</th></tr></thead><tbody><tr><td><code>C-j</code></td><td>select next candidate</td></tr><tr><td><code>C-k</code></td><td>select previous candidate</td></tr><tr><td><code>TAB</code></td><td>expand selection or select next candidate</td></tr><tr><td><code>S-TAB</code></td><td>select previous candidate</td></tr><tr><td><code>RET</code></td><td>complete word, if word is already completed insert a carriage return</td></tr></tbody></table></div></div><div id=outline-container-headline-19 class=outline-3><h3 id=headline-19>Yasnippet</h3><div id=outline-text-headline-19 class=outline-text-3><table><thead><tr><th>Key Binding</th><th>Description</th></tr></thead><tbody><tr><td><code>M-/</code></td><td>Expand a snippet if text before point is a prefix of a snippet</td></tr><tr><td><code>SPC i s</code></td><td>List all current yasnippets for inserting</td></tr></tbody></table></div></div><div id=outline-container-headline-20 class=outline-3><h3 id=headline-20>Auto-yasnippet</h3><div id=outline-text-headline-20 class=outline-text-3><table><thead><tr><th>Key Binding</th><th>Description</th></tr></thead><tbody><tr><td><code>SPC i S c</code></td><td>create a snippet from an active region</td></tr><tr><td><code>SPC i S e</code></td><td>Expand the snippet just created with <code>SPC i y</code></td></tr><tr><td><code>SPC i S w</code></td><td>Write the snippet inside <code class=verbatim>private/snippets</code> directory for future sessions</td></tr></tbody></table></div></div></div></div></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=/posts/hugo/using-org-in-hugo/><span class=button__icon>←</span>
<span class=button__text>Using Org Mode in Hugo</span></a></span>
<span class="button next"><a href=/posts/emacs/using-chinese-in-emacs/><span class=button__text>using-chinese-in-emacs.org</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>@linuxing3</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=/assets/main.js></script>
<script src=/assets/prism.js></script>
<script src=/assets/languageSelector.js></script></div></body></html>