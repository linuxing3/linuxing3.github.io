<!doctype html><html lang=en><head><title>2013-5-6-express-tutorial-1.md :: Vim Emacser Personal Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="layout: post category : lessons tagline: &amp;ldquo;Supporting tagline&amp;rdquo; tags : [intro, beginner, jekyll, tutorial] 从零开始构建Express+Mongoose的程序 如果你已经看过第一部分，请猛击这里看下一章
关于Express的框架 调用http、express和path模块 http = require 'http' path = require 'path' 生成express应用 express = require 'express' app = express() app.configure(-&amp;gt; # 设置端口 app.set('port', process.env.PORT || 3000) # 设置视图和公共目录 app.use(express.logger('dev')) # app.use(express.directory(__dirname + 'public')) app.use(express.static(path.join(__dirname, 'public'))) app.use(express.favicon()) # 设置视图渲染模板为jade app.set('views', __dirname + '/views') app.set('view engine', 'jade') # 设置查询体解析为json功能 app.use(express.bodyParser({keepExtensions: true, uploadDir: './public/resources'})) # 设置http方法重写，如使用put更改数据等 app.use(express.methodOverride()) # 设置cookie和session # app."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/posts/nodejs/2013-5-6-express-tutorial-1/><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/assets/green.css><link rel=apple-touch-icon href=/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=/img/favicon/green.png><meta name=twitter:card content="summary"><meta name=twitter:site content="https://twitter.com/linuxing3"><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="2013-5-6-express-tutorial-1.md"><meta property="og:description" content="layout: post category : lessons tagline: &amp;ldquo;Supporting tagline&amp;rdquo; tags : [intro, beginner, jekyll, tutorial] 从零开始构建Express+Mongoose的程序 如果你已经看过第一部分，请猛击这里看下一章
关于Express的框架 调用http、express和path模块 http = require 'http' path = require 'path' 生成express应用 express = require 'express' app = express() app.configure(-&amp;gt; # 设置端口 app.set('port', process.env.PORT || 3000) # 设置视图和公共目录 app.use(express.logger('dev')) # app.use(express.directory(__dirname + 'public')) app.use(express.static(path.join(__dirname, 'public'))) app.use(express.favicon()) # 设置视图渲染模板为jade app.set('views', __dirname + '/views') app.set('view engine', 'jade') # 设置查询体解析为json功能 app.use(express.bodyParser({keepExtensions: true, uploadDir: './public/resources'})) # 设置http方法重写，如使用put更改数据等 app.use(express.methodOverride()) # 设置cookie和session # app."><meta property="og:url" content="/posts/nodejs/2013-5-6-express-tutorial-1/"><meta property="og:site_name" content="Vim Emacser Personal Blog"><meta property="og:image" content="/img/favicon/green.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2018-02-16 14:05:34 -0400 -0400"></head><body class=green><div class="container full"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>Terminal</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/journal>Journal</a></li><li><a href=/showcase>Showcase</a></li><div class=spacer></div><ul class=language-selector><ul class=language-selector-current><li>English ▾</li></ul><ul class="language-selector__more hidden"><li><a href=/>English</a></li><li><a href=/zh/>中文</a></li></ul></ul></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/journal>Journal</a></li><li><a href=/showcase>Showcase</a></li><hr><li><a href=/>English</a></li><li><a href=/zh/>中文</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=/posts/nodejs/2013-5-6-express-tutorial-1/>2013-5-6-express-tutorial-1.md</a></h1><div class=post-meta><span class=post-date>2018-02-16</span></div><div class=post-content><div><hr><h2 id=tags--intro-beginner-jekyll-tutorial>layout: post
category : lessons
tagline: &ldquo;Supporting tagline&rdquo;
tags : [intro, beginner, jekyll, tutorial]</h2><h2 id=从零开始构建expressmongoose的程序>从零开始构建Express+Mongoose的程序<a href=#从零开始构建expressmongoose的程序 class=hanchor arialabel=Anchor>&#8983;</a></h2><p><a href=http://linuxing3.github.io/lessons/2013/05/06/express-tutorial-2/>如果你已经看过第一部分，请猛击这里看下一章</a></p><h3 id=关于express的框架>关于Express的框架<a href=#关于express的框架 class=hanchor arialabel=Anchor>&#8983;</a></h3><h3 id=调用httpexpress和path模块>调用http、express和path模块<a href=#调用httpexpress和path模块 class=hanchor arialabel=Anchor>&#8983;</a></h3><pre><code>http = require 'http'
path = require 'path'
</code></pre><h3 id=生成express应用>生成express应用<a href=#生成express应用 class=hanchor arialabel=Anchor>&#8983;</a></h3><pre><code>express = require 'express'
app = express()
app.configure(-&gt;
  # 设置端口
  app.set('port', process.env.PORT || 3000)
  # 设置视图和公共目录
  app.use(express.logger('dev'))
  # app.use(express.directory(__dirname + 'public'))
  app.use(express.static(path.join(__dirname, 'public')))
  app.use(express.favicon())
  # 设置视图渲染模板为jade
  app.set('views', __dirname + '/views')
  app.set('view engine', 'jade')

  # 设置查询体解析为json功能
  app.use(express.bodyParser({keepExtensions: true,     uploadDir: './public/resources'}))
  # 设置http方法重写，如使用put更改数据等
  app.use(express.methodOverride())
  # 设置cookie和session
  # app.use(express.cookieParser())
  # app.use(express.session({ secret: 'bang590' }))
  # 设置路由功能
  app.use(app.router)
  app.use(express.errorHandler({ dumpExceptions: true,     showStack: true }))
  app.enable('trust proxy')
  )
</code></pre><h3 id=启动服务器>启动服务器<a href=#启动服务器 class=hanchor arialabel=Anchor>&#8983;</a></h3><pre><code>port = process.env.PORT or 3000
http.createServer(app).listen(app.get('port'), -&gt;
  console.log(&quot;Express server listening on port &quot; + app.get('port'))
)
</code></pre><h3 id=设置列表路由>设置列表路由<a href=#设置列表路由 class=hanchor arialabel=Anchor>&#8983;</a></h3><pre><code>app.get('/blogs',mongodb.findAll)
</code></pre><h4 id=设置新建路由>设置新建路由<a href=#设置新建路由 class=hanchor arialabel=Anchor>&#8983;</a></h4><pre><code>app.get('/newblog', (req, res)-&gt;
  res.render('newblog',{title:'Input New Blog'})
)
app.post('/newblog', mongodb.create)
</code></pre><h4 id=设置统一化路由>设置统一化路由<a href=#设置统一化路由 class=hanchor arialabel=Anchor>&#8983;</a></h4><pre><code>app.all('/blog/:id/:op?',mongodb.findById)
</code></pre><h4 id=分路由>分路由<a href=#分路由 class=hanchor arialabel=Anchor>&#8983;</a></h4><pre><code>app.get('/blog/:id',mongodb.findById)
app.get('/blog/:id/edit',mongodb.findById)
app.put('/blog/:id/edit',mongodb.update)
app.post('/blog/:id/edit',mongodb.update)
app.get('/blog/:id/delete',mongodb.remo    ve)
app.get('*', (req, res)-&gt;
  res.send('what???', 404)
 )
</code></pre><h3 id=关于mongoose的框架>关于Mongoose的框架<a href=#关于mongoose的框架 class=hanchor arialabel=Anchor>&#8983;</a></h3><h4 id=确定数据库的初始化设置连接blogs集合>确定数据库的初始化设置,连接blogs集合<a href=#确定数据库的初始化设置连接blogs集合 class=hanchor arialabel=Anchor>&#8983;</a></h4><pre><code>mongoose = require('mongoose')
mongoose.connect('localhost', 'blogs')
</code></pre><h4 id=定义数据结构>定义数据结构<a href=#定义数据结构 class=hanchor arialabel=Anchor>&#8983;</a></h4><pre><code>BlogId = mongoose.Schema.ObjectId
BlogSchema = mongoose.Schema({
    owner: BlogId,
    name: String,
    age: String,
    work: String,
    email: String,
    title:String,
    content:String,
    image:String,
    date:Date
})
</code></pre><h4 id=生成表模型可作为类使用>生成表模型，可作为类使用<a href=#生成表模型可作为类使用 class=hanchor arialabel=Anchor>&#8983;</a></h4><pre><code>Blog = mongoose.model('Blog', BlogSchema)
</code></pre><h4 id=crud具体方法和函数>CRUD具体方法和函数<a href=#crud具体方法和函数 class=hanchor arialabel=Anchor>&#8983;</a></h4><pre><code>create=(req,res)-&gt;
    url = req.files.post['image'].path
    json = {
	    name: req.body.post['name'],
	    age: req.body.post['age'],
	    work: req.body.post['work'],
	    email: req.body.post['email'],
	    title:req.body.post['title'],
	    content:req.body.post['content'],
	    image:url.slice(7,url.length),
	    date:req.body.post['date']
    }
    aBlog = new Blog(json)
    aBlog.save((err)-&gt;
	console.log &quot;Hello! &quot; + aBlog.name + &quot; are &quot;+     aBlog.work
	    )
    res.redirect('blogs')
module.exports.create = create
</code></pre><h4 id=查找>查找<a href=#查找 class=hanchor arialabel=Anchor>&#8983;</a></h4><pre><code>findAll =(req,res)-&gt;
    Blog.find({},(err,docs)-&gt;
	    res.render('blogs',{title:'Blogs',blog:docs})
    )
module.exports.findAll = findAll

findById =(req,res)-&gt;
    Blog.findById(req.params.id,(err,doc)-&gt;
	    console.log &quot;Found &quot; + doc
	    res.render('editblog',{title:'Blogs',blog:doc})
    )
module.exports.findById = findById
</code></pre><h4 id=移除remove>移除remove<a href=#移除remove class=hanchor arialabel=Anchor>&#8983;</a></h4><pre><code>remove=(req,res)-&gt;
    Blog.findByIdAndRemove(req.params.id,(err,doc)-&gt;
	    console.log &quot;removed!&quot; + doc.name
	    res.redirect('blogs')
    )
module.exports.remove = remove
</code></pre><h4 id=更新update>更新update<a href=#更新update class=hanchor arialabel=Anchor>&#8983;</a></h4><pre><code>update =(req,res)-&gt;
	Blog.findByIdAndUpdate(req.params.id,req.body.post,(err,docs)-&gt;
	    console.log docs + &quot;updated!&quot;
	    res.redirect('blogs')
    )
module.exports.update = update
</code></pre></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=/posts/database/2013-5-10-redis7/><span class=button__icon>←</span>
<span class=button__text>2013-5-10-redis7.md</span></a></span>
<span class="button next"><a href=/posts/nodejs/2013-5-6-express-tutorial-2/><span class=button__text>2013-5-6-express-tutorial-2.md</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>@linuxing3</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=/assets/main.js></script>
<script src=/assets/prism.js></script>
<script src=/assets/languageSelector.js></script></div></body></html>