<!doctype html><html lang=en><head><title>babel-loader.md :: Vim Emacser Personal Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="babel-loader Babel is a compiler for writing next generation JavaScript.
This package allows transpiling JavaScript files using Babel and webpack.
Notes: Issues with the output should be reported on the babel issue tracker;
Installation npm install babel-loader babel-core babel-preset-es2015 babel-preset-react --save-dev Note: npm will deprecate auto-installing of peerDependencies on the next major release, so required peer dependencies like babel-core and webpack will have to be listed explicitly in your package.json."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/posts/nodejs/babel-loader/><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/assets/green.css><link rel=apple-touch-icon href=/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=/img/favicon/green.png><meta name=twitter:card content="summary"><meta name=twitter:site content="https://twitter.com/linuxing3"><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="babel-loader.md"><meta property="og:description" content="babel-loader Babel is a compiler for writing next generation JavaScript.
This package allows transpiling JavaScript files using Babel and webpack.
Notes: Issues with the output should be reported on the babel issue tracker;
Installation npm install babel-loader babel-core babel-preset-es2015 babel-preset-react --save-dev Note: npm will deprecate auto-installing of peerDependencies on the next major release, so required peer dependencies like babel-core and webpack will have to be listed explicitly in your package.json."><meta property="og:url" content="/posts/nodejs/babel-loader/"><meta property="og:site_name" content="Vim Emacser Personal Blog"><meta property="og:image" content="/img/favicon/green.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2018-02-16 14:05:34 -0400 -0400"></head><body class=green><div class="container full"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>Terminal</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/journal>Journal</a></li><li><a href=/showcase>Showcase</a></li><div class=spacer></div><ul class=language-selector><ul class=language-selector-current><li>English ▾</li></ul><ul class="language-selector__more hidden"><li><a href=/>English</a></li><li><a href=/zh/>中文</a></li></ul></ul></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/journal>Journal</a></li><li><a href=/showcase>Showcase</a></li><hr><li><a href=/>English</a></li><li><a href=/zh/>中文</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=/posts/nodejs/babel-loader/>babel-loader.md</a></h1><div class=post-meta><span class=post-date>2018-02-16</span></div><div class=post-content><div><h1 id=babel-loaderhttpstravis-ciorgbabelbabel-loader><a href=https://travis-ci.org/babel/babel-loader>babel-loader</a><a href=#babel-loaderhttpstravis-ciorgbabelbabel-loader class=hanchor arialabel=Anchor>&#8983;</a></h1><blockquote><p>Babel is a compiler for writing next generation JavaScript.</p></blockquote><p>This package allows transpiling JavaScript files using <a href=https://github.com/babel/babel>Babel</a> and <a href=https://github.com/webpack/webpack>webpack</a>.</p><p><strong>Notes:</strong> Issues with the output should be reported on the babel <a href=https://github.com/babel/babel/issues>issue tracker</a>;</p><h2 id=installation>Installation<a href=#installation class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npm install babel-loader babel-core babel-preset-es2015 babel-preset-react --save-dev
</span></span></code></pre></div><p><strong>Note:</strong> <a href=https://npmjs.com>npm</a> will deprecate <a href=https://github.com/npm/npm/issues/6565>auto-installing of peerDependencies</a> on the next major release, so required peer dependencies like babel-core and webpack will have to be listed explicitly in your <code>package.json</code>.</p><p><strong>Note:</strong> If you&rsquo;re upgrading from babel 5 to babel 6, please take a look <a href=https://medium.com/@malyw/how-to-update-babel-5-x-6-x-d828c230ec53#.yqxukuzdk>at this guide</a>.</p><h2 id=usage>Usage<a href=#usage class=hanchor arialabel=Anchor>&#8983;</a></h2><p><a href=http://webpack.github.io/docs/using-loaders.html>Documentation: Using loaders</a></p><p>Within your webpack configuration object, you&rsquo;ll need to add the babel-loader to the list of modules, like so:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>module</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span><span style=color:#a6e22e>loaders</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>test</span><span style=color:#f92672>:</span> <span style=color:#e6db74>/\.jsx?$/</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>exclude</span><span style=color:#f92672>:</span> <span style=color:#e6db74>/(node_modules|bower_components)/</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>loader</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;babel&#39;</span>, <span style=color:#75715e>// &#39;babel-loader&#39; is also a legal name to reference
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>query</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>presets</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#39;react&#39;</span>, <span style=color:#e6db74>&#39;es2015&#39;</span>]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=options>Options<a href=#options class=hanchor arialabel=Anchor>&#8983;</a></h3><p>See the <code>babel</code> <a href=http://babeljs.io/docs/usage/options/>options</a>.</p><p>You can pass options to the loader by writing them as a <a href=https://github.com/webpack/loader-utils>query string</a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>module</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span><span style=color:#a6e22e>loaders</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>test</span><span style=color:#f92672>:</span> <span style=color:#e6db74>/\.jsx?$/</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>exclude</span><span style=color:#f92672>:</span> <span style=color:#e6db74>/(node_modules|bower_components)/</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>loader</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;babel?presets[]=react,presets[]=es2015&#39;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>or by using the query property:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>module</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span><span style=color:#a6e22e>loaders</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>test</span><span style=color:#f92672>:</span> <span style=color:#e6db74>/\.jsx?$/</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>exclude</span><span style=color:#f92672>:</span> <span style=color:#e6db74>/(node_modules|bower_components)/</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>loader</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;babel&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>query</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>presets</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#39;react&#39;</span>, <span style=color:#e6db74>&#39;es2015&#39;</span>]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This loader also supports the following loader-specific option:</p><ul><li><p><code>cacheDirectory</code>: Default <code>false</code>. When set, the given directory will be used to cache the results of the loader. Future webpack builds will attempt to read from the cache to avoid needing to run the potentially expensive Babel recompilation process on each run. If the value is blank (<code>loader: 'babel-loader?cacheDirectory'</code>) the loader will use the default OS temporary file directory.</p></li><li><p><code>cacheIdentifier</code>: Default is a string composed by the babel-core&rsquo;s version, the babel-loader&rsquo;s version and the contents of .babelrc file if it exists. This can set to a custom value to force cache busting if the identifier changes.</p></li></ul><p><strong>Note:</strong> The <code>sourceMap</code> option is ignored, instead sourceMaps are automatically enabled when webpack is configured to use them (via the <code>devtool</code> config option).</p><h2 id=troubleshooting>Troubleshooting<a href=#troubleshooting class=hanchor arialabel=Anchor>&#8983;</a></h2><h3 id=babel-loader-is-slow>babel-loader is slow!<a href=#babel-loader-is-slow class=hanchor arialabel=Anchor>&#8983;</a></h3><p>Make sure you are transforming as few files as possible. Because you are probably
matching <code>/\.js$/</code>, you might be transforming the <code>node_modules</code> folder or other unwanted
source.</p><p>To exclude <code>node_modules</code>, see the <code>exclude</code> option in the <code>loaders</code> config as documented above.</p><p>You can also speed up babel-loader by as much as 2x by using the <code>cacheDirectory</code> option.
This will cache transformations to the filesystem.</p><h3 id=babel-is-injecting-helpers-into-each-file-and-bloating-my-code>babel is injecting helpers into each file and bloating my code!<a href=#babel-is-injecting-helpers-into-each-file-and-bloating-my-code class=hanchor arialabel=Anchor>&#8983;</a></h3><p>babel uses very small helpers for common functions such as <code>_extend</code>. By default
this will be added to every file that requires it.</p><p>You can instead require the babel runtime as a separate module to avoid the duplication.</p><p>The following configuration disables automatic per-file runtime injection in babel, instead
requiring <code>babel-plugin-transform-runtime</code> and making all helper references use it.</p><p>See the <a href=http://babeljs.io/docs/plugins/transform-runtime/>docs</a> for more information.</p><p><strong>NOTE:</strong> You must run <code>npm install babel-plugin-transform-runtime --save</code> to include this in your project.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>loaders</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>  <span style=color:#75715e>// the &#39;transform-runtime&#39; plugin tells babel to require the runtime
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// instead of inlining it.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>test</span><span style=color:#f92672>:</span> <span style=color:#e6db74>/\.jsx?$/</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>exclude</span><span style=color:#f92672>:</span> <span style=color:#e6db74>/(node_modules|bower_components)/</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>loader</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;babel&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>query</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>presets</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#39;react&#39;</span>, <span style=color:#e6db74>&#39;es2015&#39;</span>],
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>plugins</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#39;transform-runtime&#39;</span>]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><h3 id=using-cachedirectory-fails-with-enoent-error>using <code>cacheDirectory</code> fails with ENOENT Error<a href=#using-cachedirectory-fails-with-enoent-error class=hanchor arialabel=Anchor>&#8983;</a></h3><p>If using cacheDirectory results in an error similar to the following:</p><pre tabindex=0><code>ERROR in ./frontend/src/main.jsx
Module build failed: Error: ENOENT, open &#39;true/350c59cae6b7bce3bb58c8240147581bfdc9cccc.json.gzip&#39;
 @ multi app
</code></pre><p>(notice the <code>true/</code> in the filepath)</p><p>That means that most likely, you&rsquo;re not setting the options correctly, and you&rsquo;re doing something similar to:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>loaders</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>test</span><span style=color:#f92672>:</span> <span style=color:#e6db74>/\.jsx?$/</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>exclude</span><span style=color:#f92672>:</span> <span style=color:#e6db74>/(node_modules|bower_components)/</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>loader</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;babel?cacheDirectory=true&#39;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><p>That&rsquo;s not the correct way of setting boolean values. You should do instead:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>loaders</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>test</span><span style=color:#f92672>:</span> <span style=color:#e6db74>/\.jsx?$/</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>exclude</span><span style=color:#f92672>:</span> <span style=color:#e6db74>/(node_modules|bower_components)/</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>loader</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;babel?cacheDirectory&#39;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><p>or use the <a href=https://webpack.github.io/docs/using-loaders.html#query-parameters>query</a> property:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>loaders</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>  <span style=color:#75715e>// the optional &#39;runtime&#39; transformer tells babel to require the runtime
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// instead of inlining it.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>test</span><span style=color:#f92672>:</span> <span style=color:#e6db74>/\.jsx?$/</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>exclude</span><span style=color:#f92672>:</span> <span style=color:#e6db74>/(node_modules|bower_components)/</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>loader</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;babel&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>query</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>cacheDirectory</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><h3 id=custom-polyfills-eg-promise-library>custom polyfills (e.g. Promise library)<a href=#custom-polyfills-eg-promise-library class=hanchor arialabel=Anchor>&#8983;</a></h3><p>Since Babel includes a polyfill that includes a custom <a href=https://github.com/facebook/regenerator/blob/master/runtime.js>regenerator runtime</a> and <a href=https://github.com/zloirock/core-js>core.js</a>, the following usual shimming method using <code>webpack.ProvidePlugin</code> will not work:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>webpack</span>.<span style=color:#a6e22e>ProvidePlugin</span>({
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;Promise&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;bluebird&#39;</span>
</span></span><span style=display:flex><span>        }),
</span></span><span style=display:flex><span><span style=color:#75715e>// ...
</span></span></span></code></pre></div><p>The following approach will not work either:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;babel-runtime/core-js/promise&#39;</span>).<span style=color:#66d9ef>default</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;bluebird&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>promise</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Promise;
</span></span></code></pre></div><p>which outputs to (using <code>runtime</code>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#e6db74>&#39;use strict&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>_Promise</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;babel-runtime/core-js/promise&#39;</span>)[<span style=color:#e6db74>&#39;default&#39;</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;babel-runtime/core-js/promise&#39;</span>)[<span style=color:#e6db74>&#39;default&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;bluebird&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>promise</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>_Promise</span>();
</span></span></code></pre></div><p>The previous <code>Promise</code> library is referenced and used before it is overridden.</p><p>One approach is to have a &ldquo;bootstrap&rdquo; step in your application that would first override the default globals before your application:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// bootstrap.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;babel-runtime/core-js/promise&#39;</span>).<span style=color:#66d9ef>default</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;bluebird&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;./app&#39;</span>);
</span></span></code></pre></div><h2 id=licensehttpcoutomit-licenseorg><a href=http://couto.mit-license.org/>License</a><a href=#licensehttpcoutomit-licenseorg class=hanchor arialabel=Anchor>&#8983;</a></h2></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=/posts/linux/archlinux/><span class=button__icon>←</span>
<span class=button__text>archlinux.md</span></a></span>
<span class="button next"><a href=/posts/python/basic/><span class=button__text>basic.md</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>@linuxing3</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=/assets/main.js></script>
<script src=/assets/prism.js></script>
<script src=/assets/languageSelector.js></script></div></body></html>